# AINPC â€” Diegetic NPC System for Discord D&D

## Project Codename
**AINPC**

## Primary Bot Name
**Meepo**

(Meepo is the container bot. Personas live inside Meepo.)

---

## High-Level Vision

AINPC is a Discord bot that functions as a **diegetic, in-world NPC** for a D&D campaign.

It is not a DM tool, not a rules engine, and not an omniscient narrator.

Instead, it:
- Exists *inside the world*
- Participates only when addressed
- Remembers conversations as history
- Helps the party recall past events, NPC interactions, and moments
- Maintains uncertainty, limits, and personality

Voice is a future feature; text-first MVP is complete.

---

## Core Design Pillars (Lock These In)

### 1. Diegetic Presence
- The NPC is a character in the world
- Never says â€œas an AIâ€ or breaks character
- Has a location, limits, and perspective
- Admits ignorance freely

### 2. Ledger-First Architecture
- The **Ledger** is the source of truth
- Everything spoken in the world is recorded:
  - Humans
  - NPCs (including Meepo/Xoblob)
- The Ledger is:
  - Append-only
  - Time-ordered
  - Attributable (who spoke)
  - Tagged (human vs npc, source, persona)

### 3. Separation of Concerns
- **Ledger** = what happened
- **Persona Prompt** = how the NPC speaks
- **NPC Mind (future)** = what the NPC believes
- NPC speech is *never* authoritative truth

### 4. Minimal Commands, Natural Interaction
- Players talk to Meepo naturally
- Slash commands exist for setup / inspection only
- Transformations and interaction are chat-driven

---

## System Layers

### Layer 1: Ledger (Implemented)

**Purpose:**  
Record the omniscient history of the session.

**Stored Data (current):**
- guild_id
- channel_id
- message_id
- author_id
- author_name
- timestamp_ms
- content
- tags

**Tag Examples:**
- `human`
- `npc,meepo,spoken`
- `npc,xoblob,spoken`
- `system,action,transform`
- `source:chat` (future: `tts`, `stt`)

**Key Rule:**  
> If it was said in the world, it goes in the Ledger.

---

### Layer 2: Persona System (Implemented)

Meepo can **assume different NPC personas** the party has met.

This is diegetically explained as **Meepo mimicking remembered NPCs** to help the party recall past conversations.

Meepo does NOT gain omniscience when transforming.

---

## Personas

### Persona: Meepo (Default)

**Identity**
- Newborn celestial servant of the Wanderer
- Gentle, curious, cautious
- Speaks simply
- Ends every sentence with **â€œmeepâ€**

**Role**
- Emotional companion
- Reminder of past conversations
- Soft memory anchor

**Knowledge**
- Only what Meepo personally witnessed
- Or what others explicitly told Meepo

---

### Persona: Old Xoblob (Entity-13V)

**Classification**
- RECKONING APPROVED â€“ INCOHERENT SPEECH FILTER ON
- Containment Level: ðŸ”µ Blue
- â€œDo not speak back. Riddle quarantine in progress.â€

**Identity**
- Void-touched gnome
- Half-sane, half-fractured
- Knows things indirectly and unreliably
- Repeats motifs (â€œbee ate a peaâ€)

**Speech Style**
- Riddles, rhymes, metaphors
- Sing-song cadence
- Rarely answers directly
- Often circles truth without stating it

**Important Constraint**
> Xoblob does NOT explain secrets cleanly, even if he â€œknowsâ€ them.

**Use Case**
- Atmospheric storytelling
- Foreshadowing
- Distorted recall of past NPC interactions
- Bestiary encounters

---

## Persona Transformations (Implemented MVP)

### Transform Model
- One bot (Meepo)
- One active persona per guild
- Persona stored on active npc instance

### How Transform Happens
**No slash command required.**

Triggered by natural language in chat:
- â€œmeepo transform into xoblobâ€
- â€œxoblob come outâ€
- â€œmeepo turn backâ€
- â€œnormal meepo againâ€

### Rules
- Only works if Meepo is active
- Only in the bound channel
- Automatically latches conversation
- Acknowledges transformation in-character
- Logged in Ledger

---

## Interaction Rules

### Speaking
- Meepo (or persona) **never speaks unless addressed**
- Addressing can be:
  - Name mention
  - Prefix (e.g. `meepo:`)
  - Post-transform auto-latch

### Latch
- Once addressed, NPC continues conversation
- Times out after silence
- Transform auto-sets latch

---

## Commands (Minimal Surface)

### Player-Facing
None required for normal play.

### Setup / Inspection
- `/meepo wake` â€” spawn Meepo in channel
- `/meepo sleep` â€” dismiss Meepo
- `/meepo status` â€” DM convenience (optional)

(Meepo can also be woken implicitly via chat mentioning â€œmeepoâ€ if enabled.)

---

## Recaps (Implemented v1)

### Source
- Ledger slices by time/session

### Modes
- `/session recap party`
- `/session recap dm`

### Includes
- Human speech
- NPC speech (Meepo, Xoblob)
- Ordered dialogue for coherence

### Rule
> Recaps summarize ONLY whatâ€™s in the Ledger.  
> No added facts.

---

## Safety & Cost Controls (Implemented)

- LLM_ENABLED kill switch
- Low temperature
- Token limits
- No emoji / no meta guardrails
- Explicit anti-hallucination rules in system prompt

---

## Future (Not Yet Implemented)

### NPC Mind
- Persona-specific belief store
- Ingests events, not dialogue
- Handles uncertainty, provenance, confidence

### Voice
- Join voice channel
- STT â†’ Ledger
- TTS â†’ NPC speech
- Same Ledger-driven recap pipeline

---

## Design North Star

> **AINPC is not smart because it knows everything.  
> It is compelling because it knows *just enough*, imperfectly, and remembers like a character would.**

---

## Current Status

âœ… Week 1 MVP complete  
âœ… Persona system live  
âœ… Ledger solid  
âœ… Recaps usable  
âœ… UX feels magical without commands  

Ready for:
- More personas
- Light NPC Mind
- Voice experiments
- Story-driven expansion

